---
# ============================================================================
# DÃ‰PLOIEMENT NEXTCLOUD MINI - DÃ‰MONSTRATION ACADÃ‰MIQUE
# Infrastructure Zero Trust - Automatisation par IaC
# ============================================================================

- name: "ğŸš€ DÃ©ploiement Nextcloud automatisÃ©"
  hosts: apps
  gather_facts: yes
  become: yes
  
  pre_tasks:
    - name: "ğŸ“¢ Annonce dÃ©marrage dÃ©ploiement"
      debug:
        msg:
          - ""
          - "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
          - "â•‘                                                               â•‘"
          - "â•‘        DÃ‰PLOIEMENT NEXTCLOUD - DÃ‰MONSTRATION IaC              â•‘"
          - "â•‘                                                               â•‘"
          - "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          - ""
          - "Serveur cible : {{ inventory_hostname }} ({{ ansible_default_ipv4.address }})"
          - "Mode offline  : {{ offline_mode | default(false) }}"
          - "Port HTTP     : {{ nextcloud_http_port }}"
          - ""
          - "â±ï¸  DurÃ©e estimÃ©e : 3-5 minutes"
          - ""
      delegate_to: localhost
      run_once: yes

    - name: "â¸ï¸  Pause lecture (3 secondes)"
      pause:
        seconds: 3
      delegate_to: localhost
      run_once: yes

  roles:
    - role: nextcloud-mini
      tags: [nextcloud, deploy]

  post_tasks:
    - name: "ğŸ‰ RÃ©sumÃ© dÃ©ploiement"
      debug:
        msg:
          - ""
          - "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
          - "â•‘                                                               â•‘"
          - "â•‘           âœ… NEXTCLOUD DÃ‰PLOYÃ‰ AVEC SUCCÃˆS !                  â•‘"
          - "â•‘                                                               â•‘"
          - "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          - ""
          - "ğŸ”— URL d'accÃ¨s :"
          - "   http://{{ ansible_default_ipv4.address }}:{{ nextcloud_http_port }}"
          - ""
          - "ğŸ‘¤ Connexion :"
          - "   Utilisateur : {{ nextcloud_admin_user }}"
          - "   Mot de passe: {{ nextcloud_admin_password }}"
          - ""
          - "ğŸ“Š Services actifs :"
          - "   â€¢ Apache2    : Port {{ nextcloud_http_port }}"
          - "   â€¢ MariaDB    : localhost:3306"
          - "   â€¢ Nextcloud  : v{{ nextcloud_version }}"
          - ""
          - "ğŸ“ Emplacements :"
          - "   â€¢ Application : {{ nextcloud_install_dir }}"
          - "   â€¢ DonnÃ©es     : {{ nextcloud_data_dir }}"
          - ""
          - "â±ï¸  DurÃ©e totale : {{ ansible_play_time | default('N/A') }}"
          - ""
          - "ğŸ¯ Infrastructure prÃªte pour dÃ©monstration !"
          - ""
      delegate_to: localhost
      run_once: yes
